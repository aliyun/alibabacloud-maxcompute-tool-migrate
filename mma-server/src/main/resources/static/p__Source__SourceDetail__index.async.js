"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[142],{71886:function(le,U,e){e.d(U,{J:function(){return l}});var N=e(29883),b=e.n(N),X=e(37306),x=e.n(X),h=e(66933),D=e.n(h),R=e(94043),G=e.n(R),$=e(61122),p=e(5966),F=e(64317),w=e(93083),L=e(86615),V=e(97462),y=e(90672),z=e(52688),s=e(31768),I=e(24739),C=e(62435),J=e(51198),H=e(48086),W=e(5251),a=e(86074),l=function(t){var m,j=(0,C.useState)(),o=D()(j,2),u=o[0],c=o[1],v=(0,C.useState)(!1),f=D()(v,2),S=f[0],O=f[1],Q={},_=(0,C.useState)(Q),P=D()(_,2),r=P[0],Y=P[1],q=(0,C.useRef)(),K=(0,C.useRef)(null);(0,C.useEffect)(function(){var M,B,A;if(t.db!=null){var n=t.db;(0,J.S5)(n.sourceName,n.name).then(function(E){c(E.data),r!==void 0&&(r.task_type=E.data.defaultTaskType)}),r.source_name=(M=t.db)===null||M===void 0?void 0:M.sourceName,r.db_name=(B=t.db)===null||B===void 0?void 0:B.name,(t==null?void 0:t.tables)!==void 0&&(r.tables=t==null?void 0:t.tables),t.jobType=="database"&&(r.description=n.name),Y(r),(A=q.current)===null||A===void 0||A.resetFields()}},[t.db,t.tables,t.visible]);var ee={},T=x()((u==null?void 0:u.tables)||[]),ie;try{for(T.s();!(ie=T.n()).done;){var oe=ie.value;ee[oe]=oe}}catch(M){T.e(M)}finally{T.f()}var re=[{required:!1,warningOnly:!0,pattern:/^((\w+)\s*,\s*)*(\w+)$/,message:"\u591A\u4E2A\u8868\u540D\u4E4B\u95F4\u4EE5\u9017\u53F7(,)\u5206\u5272"}];return(m=K.current)===null||m===void 0||m.focus(),(0,a.jsx)($.Y,{title:"\u65B0\u5EFA\u8FC1\u79FB\u4EFB\u52A1",visible:t.visible,onVisibleChange:t.setVisible,layout:"horizontal",grid:!0,labelCol:{span:3},labelAlign:"left",formRef:q,onFinish:function(){var M=b()(G().mark(function B(A){var n,E,Z,g,k,ae,te,ne,_e;return G().wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:n={},Object.assign(n,A),delete n.enable_config,E="partition_filters",E in n&&(Z=i(n[E],"srcTable","partitionFilter"),Object.keys(Z).length>0?n[E]=Z:delete n[E]),g="table_mapping",g in n&&(k=i(n[g],"srcTable","dstTable"),Object.keys(k).length>0?n[g]=k:delete n[g]),ae="table_whitelist",te="table_blacklist",ae in n&&(n[ae]=n[ae].trim().split(/\s*,\s*/)),te in n&&(n[te]=n[te].trim().split(/\s*,\s*/)),ne="tables",ne in n&&(n[ne]=n[ne].trim().split(/\s*,\s*/)),n.type=t.jobType,Y(n),_e=H.ZP.loading("\u63D0\u4EA4\u8FC1\u79FB\u4EFB\u52A1\u4E2D..."),(0,J.p1)(n).then(function(se){if(se.success){t.setVisible(!1);return}(0,W.oc)(se)}).catch(function(se){var de=se.response.data;H.ZP.error(de.message,10)}).finally(function(){_e()});case 17:case"end":return ue.stop()}},B)}));return function(B){return M.apply(this,arguments)}}(),children:function(){if(!S){var M,B,A;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{name:"description",label:"\u540D\u79F0:",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",initialValue:"".concat((M=t.db)===null||M===void 0?void 0:M.name,"@").concat((0,W.je)()),rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u540D\u79F0"}],fieldProps:{ref:K}}),(0,a.jsx)(p.Z,{name:"source_name",label:"\u6570\u636E\u6E90:",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",initialValue:(B=t.db)===null||B===void 0?void 0:B.sourceName,disabled:!0}),(0,a.jsx)(p.Z,{name:"db_name",label:"\u5E93\u540D:",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",initialValue:(A=t.db)===null||A===void 0?void 0:A.name,disabled:!0}),(0,a.jsx)(F.Z,{colProps:{span:24},label:"\u4EFB\u52A1\u7C7B\u578B:",name:"task_type",initialValue:u==null?void 0:u.defaultTaskType,valueEnum:u==null?void 0:u.taskTypes,rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u4EFB\u52A1\u7C7B\u578B"}]}),(0,a.jsx)(F.Z,{colProps:{span:24},label:"mc\u9879\u76EE:",name:"dst_mc_project",valueEnum:function(){var n={},E=x()((u==null?void 0:u.dstMcProjects)||[]),Z;try{for(E.s();!(Z=E.n()).done;){var g=Z.value;n[g]=g}}catch(k){E.e(k)}finally{E.f()}return n}(),rules:[{required:!0,message:"\u8BF7\u9009\u62E9mc\u9879\u76EE"}]}),function(){if(t.jobType==="database")return(0,a.jsxs)(w.A.Group,{children:[(0,a.jsx)(L.Z.Group,{name:"whiteOrBlackList",colProps:{offset:3},initialValue:"tableWhiteList",options:[{label:"table\u767D\u540D\u5355",value:"tableWhiteList"},{value:"tableBlackList",label:"table\u9ED1\u540D\u5355"}]}),(0,a.jsx)(V.Z,{name:["whiteOrBlackList"],children:function(Z){var g=Z.whiteOrBlackList;return g==="tableBlackList"?(0,a.jsx)(y.Z,{name:"table_blacklist",label:"table\u9ED1\u540D\u5355",rules:re}):(0,a.jsx)(y.Z,{name:"table_whitelist",label:"table\u767D\u540D\u5355",rules:re})}})]});if(t.jobType=="tables"){var n;return(0,a.jsx)(y.Z,{name:"tables",label:"table\u5217\u8868",rules:re,initialValue:t==null||(n=t.tables)===null||n===void 0?void 0:n.join(",")})}}(),(0,a.jsx)(z.Z,{colProps:{span:24},initialValue:!0,label:"\u5F00\u542F\u6821\u9A8C",name:"enable_verification"}),(0,a.jsx)(z.Z,{colProps:{span:24},initialValue:!0,label:"\u589E\u91CF\u66F4\u65B0",name:"increment"}),(0,a.jsx)(z.Z,{colProps:{span:24},initialValue:!1,label:"\u53EA\u8FC1schema",name:"schema_only"}),(0,a.jsx)(s.u,{name:"partition_filters",label:"\u5206\u533A\u8FC7\u6EE4",children:(0,a.jsxs)(I.UW,{children:[(0,a.jsx)(F.Z,{showSearch:!0,name:"srcTable",valueEnum:ee,colProps:{span:10},placeholder:"\u8BF7\u8F93\u5165\u6E90\u8868"}),(0,a.jsx)(p.Z,{name:"partitionFilter",placeholder:"p1 > '2022-08-20' and p2 > 10",colProps:{span:10}})]},"group")}),(0,a.jsx)(s.u,{name:"table_mapping",label:"\u8868\u540D\u6620\u5C04",children:(0,a.jsxs)(I.UW,{children:[(0,a.jsx)(F.Z,{showSearch:!0,name:"srcTable",valueEnum:ee,colProps:{span:10},placeholder:"\u8BF7\u8F93\u5165\u6E90\u8868"}),(0,a.jsx)(p.Z,{name:"dstTable",colProps:{span:10},placeholder:"\u8BF7\u8F93\u5165\u76EE\u7684\u8868"})]},"group")})]})}return(0,a.jsx)(y.Z,{name:"jsonConfig",label:"\u914D\u7F6E\u6587\u4EF6",initialValue:JSON.stringify(r,null,4)})}()})};function i(d,t,m){var j=d.filter(function(f){return t in f&&m in f}),o={},u=x()(j),c;try{for(u.s();!(c=u.n()).done;){var v=c.value;o[v[t]]=v[m]}}catch(f){u.e(f)}finally{u.f()}return o}},73473:function(le,U,e){e.d(U,{v:function(){return y}});var N=e(29883),b=e.n(N),X=e(66933),x=e.n(X),h=e(94043),D=e.n(h),R=e(62435),G=e(8836),$=e(50146),p=e(76772),F=e(54458),w=e(10581),L=e(43758),V=e(86074),y=function(s){var I=s==null?void 0:s.dataSource,C=(0,R.useState)(0),J=x()(C,2),H=J[0],W=J[1],a=(0,R.useState)(""),l=x()(a,2),i=l[0],d=l[1],t=(0,R.useState)(!1),m=x()(t,2),j=m[0],o=m[1],u=I==null?void 0:I.id,c=function(){s.onCancel(),o(!1)};return(0,R.useEffect)(function(){if(u!=null){o(!1),d(""),W(0);var v=setInterval(b()(D().mark(function f(){var S,O;return D().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.next=2,(0,G.jp)(u);case 2:S=_.sent,S.success?(O=S.progress,O>0&&W(O),(O>=100||O<0)&&(clearInterval(v),o(!0),W(100),w.m.push(L.h))):(d(S.message),o(!0),clearInterval(v));case 4:case"end":return _.stop()}},f)})),2e3)}},[u]),(0,V.jsxs)($.Z,{title:'"'.concat(I==null?void 0:I.name,'"\u5143\u6570\u636E\u66F4\u65B0\u8FDB\u5EA6'),visible:s.visible,closable:j,keyboard:!1,maskClosable:!1,destroyOnClose:!0,footer:null,onCancel:c,children:[i===""?"":(0,V.jsx)(p.Z,{message:i,type:"error",showIcon:!0}),(0,V.jsx)(F.Z,{percent:H,status:i===""?"active":"exception"})]})}},43758:function(le,U,e){e.d(U,{L:function(){return b},h:function(){return N}});var N="/sources",b="/sourcesNew"},24969:function(le,U,e){e.r(U),e.d(U,{default:function(){return W}});var N=e(66933),b=e.n(N),X=e(85067),x=e(18036),h=e(62435),D=e(8836),R=e(29883),G=e.n(R),$=e(94043),p=e.n($),F=e(15999),w=e(91894),L=e(4914),V=e(5251),y=e(71886),z=e(43758),s=e(86074),I=function(a){var l=a==null?void 0:a.source,i=(0,h.useState)(null),d=b()(i,2),t=d[0],m=d[1],j=(0,h.useState)(!1),o=b()(j,2),u=o[0],c=o[1],v=(0,h.useState)(0),f=b()(v,2),S=f[0],O=f[1],Q=[{title:"\u6570\u636E\u6E90",dataIndex:"sourceName",hideInTable:(l==null?void 0:l.id)!=null,hideInSearch:(l==null?void 0:l.id)!=null},{title:"\u5E93\u540D",dataIndex:"name",render:function(P,r){return(0,s.jsx)(x.Link,{to:"".concat(z.h,"/").concat(l==null?void 0:l.name,"/").concat(r.name,"?sourceId=").concat(l==null?void 0:l.id,"&dbId=").concat(r.id),children:r.name})}},{title:"table\u603B\u6570",search:!1,dataIndex:"tables"},{title:"\u8FC1\u79FB\u5B8C\u6210table\u6570",search:!1,dataIndex:"tablesDone"},{title:"\u6709\u9519\u8BEF\u7684table\u6570",search:!1,dataIndex:"tablesFailed",hideInTable:!0},{title:"\u90E8\u5206\u5B8C\u6210table\u6570",search:!1,dataIndex:"tablesPartDone",hideInTable:!0},{title:"\u6B63\u5728\u8FC1\u79FBtable\u6570",search:!1,dataIndex:"tablesDoing",hideInTable:!0},{title:"\u5206\u533A\u603B\u6570",search:!1,dataIndex:"partitions"},{title:"\u8FC1\u79FB\u5B8C\u6210\u5206\u533A\u6570",search:!1,dataIndex:"partitionsDone"},{title:"\u51FA\u9519\u7684\u5206\u533A\u6570",search:!1,dataIndex:"partitionsFailed",hideInTable:!0},{title:"\u6B63\u5728\u8FC1\u79FB\u5206\u533A\u6570",search:!1,dataIndex:"partitionsDoing",hideInTable:!0},{title:"\u5927\u5C0F",dataIndex:"size",render:function(P,r){return r.size===void 0||r.size===0?"--":(0,V.BU)(r.size)},search:!1,sorter:{compare:function(P,r){return 0},multiple:1}},{title:"\u884C\u6570",dataIndex:"numRows",render:function(P,r){return r.numRows===void 0||r.numRows===0?"--":r.numRows},search:!1,sorter:{compare:function(P,r){return 0},multiple:2}},{title:"\u72B6\u6001",dataIndex:"status",valueType:"select",valueEnum:{INIT:{text:"\u672A\u8FC1\u79FB"},DONE:{text:"\u5B8C\u6210"},DOING:{text:"\u8FC1\u79FB\u4E2D"},FAILED:{text:"\u90E8\u5206\u5B8C\u6210\uFF0C\u6709\u5931\u8D25"},PART_DONE:{text:"\u90E8\u5206\u5B8C\u6210"}},filters:!0},{title:"\u64CD\u4F5C",render:function(P,r){return[(0,s.jsx)("a",{onClick:function(){c(!0),m(r)},children:"\u8FC1\u79FB"},1)]},search:!1}];return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(F.Z,{columns:Q,request:function(){var _=G()(p().mark(function P(r,Y,q){var K;return p().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return r.sourceId=l==null?void 0:l.id,T.next=3,(0,D.Ui)(r,Y,q);case 3:return K=T.sent,O((K==null?void 0:K.total)||0),T.abrupt("return",K);case 6:case"end":return T.stop()}},P)}));return function(P,r,Y){return _.apply(this,arguments)}}(),rowKey:"id",pagination:{showQuickJumper:!0,size:"default",responsive:!0,totalBoundaryShowSizeChanger:2,total:S},search:{filterType:"light"},tableExtraRender:function(P,r){return l==null?(0,s.jsx)(s.Fragment,{}):(0,s.jsx)(w.Z,{children:(0,s.jsxs)(L.Z,{size:"small",column:3,children:[(0,s.jsx)(L.Z.Item,{label:"\u6570\u636E\u5E93",children:l.dbNum},1),(0,s.jsx)(L.Z.Item,{label:"\u8868",children:l.tableNum},2),(0,s.jsx)(L.Z.Item,{label:"\u5206\u533A",children:l.partitionNum},3),(0,s.jsx)(L.Z.Item,{label:"\u6700\u65B0\u66F4\u65B0\u65F6\u95F4",children:l.lastUpdateTime},4)]})})}}),(0,s.jsx)(y.J,{db:t,jobType:"database",visible:u,setVisible:c})]})},C=e(32633),J=e(73473),H=function(l){var i=l.source,d=(0,h.useState)(),t=b()(d,2),m=t[0],j=t[1],o=(0,h.useState)(!1),u=b()(o,2),c=u[0],v=u[1],f=function(){return i===void 0?(0,s.jsx)("div",{children:'"\u8BF7\u5237\u65B0\u9875\u9762"'}):(l==null?void 0:l.tabKey)==="data"?(0,s.jsx)(I,{source:i}):(0,s.jsx)(C.Z,{request:function(){return(0,D.S6)(i==null?void 0:i.name)},onSave:function(Q){return(0,D.Ih)(i==null?void 0:i.id,Q)},afterSave:function(){}})};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(f,{}),(0,s.jsx)(J.v,{dataSource:m,visible:c,onCancel:function(){v(!1),j(void 0)}})]})},W=function(){var a=(0,x.useParams)(),l=(0,h.useState)(),i=b()(l,2),d=i[0],t=i[1],m=(0,h.useState)("data"),j=b()(m,2),o=j[0],u=j[1];return(0,h.useEffect)(function(){(0,D.xh)((a==null?void 0:a.name)||"0",!0).then(function(c){return t(c.data)})},[a]),(0,s.jsx)(X._z,{header:{title:d==null?void 0:d.name},tabList:[{tab:"\u6570\u636E\u4FE1\u606F",key:"data"},{tab:"\u914D\u7F6E\u4FE1\u606F",key:"config"}],onTabChange:function(v){u(v)},children:(0,s.jsx)(H,{source:d,tabKey:o})})}}}]);
